"use strict";var viewModel={posts:ko.observableArray(),filteredPosts:ko.observableArray(),categories:ko.observableArray(),loggedinUser:ko.observable(),username:ko.observable(localStorage.getItem("username")),successMessage:ko.observable(),failuerMessage:ko.observable(),checkLoggedinUser:function(){null!=localStorage.getItem("access_token")?viewModel.loggedinUser(!0):viewModel.loggedinUser(!1)},signin:function(){var e=viewModel.signinInputs,t=e.email,o=e.password,a=[t,o];for(var s in a){var i=a[s];if(!0!==i.valid())return void i.valid(!1)}do_signin({email:t.value(),password:o.value()})&&($(".modal").modal("hide"),viewModel.fetchData())},signinInputs:{email:{value:ko.observable(""),valid:ko.observable()},password:{value:ko.observable(""),valid:ko.observable()}},validateSigninInputs:{validateEmail:function(){var e=viewModel.signinInputs.email;e.value().length<6||-1==e.value().indexOf("@")?e.valid(!1):e.valid(!0)},validatePassword:function(){var e=viewModel.signinInputs.password;e.value().length<6||-1!=e.value().indexOf(" ")?e.valid(!1):e.valid(!0)}},saveAccessToken:function(e){localStorage.setItem("access_token",e),viewModel.fetchData()},signup:function(){var e=viewModel.signupInputs,t=e.username,o=e.email,a=e.password,s=[t,o,a];for(var i in s){var n=s[i];if(!0!==n.valid())return void n.valid(!1)}var l={username:t.value(),password:a.value(),email:o.value()};if(do_signup(l)){$(".modal").modal("hide"),viewModel.successMessage("You are now digned up, and can login..")}},signupInputs:{username:{value:ko.observable(""),valid:ko.observable()},email:{value:ko.observable(""),valid:ko.observable()},password:{value:ko.observable(""),valid:ko.observable()}},validateSignupInputs:{validateUsername:function(){var e=viewModel.signupInputs.username;e.value().length<2?e.valid(!1):e.valid(!0)},validateEmail:function(){var e=viewModel.signupInputs.email;e.value().length<6||-1==e.value().indexOf("@")?e.valid(!1):e.valid(!0)},validatePassword:function(){var e=viewModel.signupInputs.password;e.value().length<6||-1!=e.value().indexOf(" ")?e.valid(!1):e.valid(!0)}},signout:function(){localStorage.removeItem("access_token"),localStorage.removeItem("username"),viewModel.removeDataFromView(),viewModel.loggedinUser(!1),viewModel.username("")},getCategories:function(){fetch("http://18.221.127.237/categories").then(function(e){if(200!==e.status)return alert("Error while fetching data."),void e.json().then(function(e){viewModel.failuerMessage(e.message)});e.json().then(function(e){viewModel.categories(e.categories)})}).catch(function(e){alert("Error while fetching data."),console.log("Fetch Error :-S",e)})},getPosts:function(){null!=localStorage.getItem("access_token")&&do_getPosts()},filterPosts:function(t){var e=viewModel.posts().filter(function(e){return e.category_id==t.id});viewModel.filteredPosts(e)},clearFilter:function(){viewModel.filteredPosts.removeAll()},addPost:function(){var e=viewModel.addPostInputs,t=e.title,o=[t],a=$("#category").val(),s=CKEDITOR.instances.addPostBody.getData();if(a.length<1)return!1;if(s.length<20)return $("#addPostBody").css("border","1px solid red"),e.body.valid(!1),!1;for(var i in e.body.valid(!0),o){var n=o[i];if(!0!==n.valid())return void n.valid(!1)}do_addPost({category_id:a,title:t.value(),body:s})&&(s="",t.value(""),$(".modal").modal("hide"),viewModel.getPosts(),viewModel.successMessage("Added Post successfully."))},addPostInputs:{category:{value:ko.observable(""),valid:ko.observable()},title:{value:ko.observable(""),valid:ko.observable()},body:{value:ko.observable(""),valid:ko.observable()}},validateAddPostInputs:{validateCategory:function(){var e=viewModel.addPostInputs.category;0<e.value().length?valid.valid(!1):e.valid(!0)},validateTitle:function(){var e=viewModel.addPostInputs.title;e.value().length<6?e.valid(!1):e.valid(!0)},validateBody:function(){viewModel.addPostInputs.body.valid(!0)}},setPostToEdit:function(e,t){var o=viewModel.postToEditInputs;o.id.value(e.id),o.category.value(e.category),o.title.value(e.title),o.body.value(e.body)},postToEditInputs:{id:{value:ko.observable("")},category:{value:ko.observable(""),valid:ko.observable()},title:{value:ko.observable(""),valid:ko.observable(!0)},body:{value:ko.observable(""),valid:ko.observable(!0)}},validatePostToEditInputs:{validateCategory:function(){var e=viewModel.postToEditInputs.category;0<e.value().length?valid.valid(!1):e.valid(!0)},validateTitle:function(){var e=viewModel.postToEditInputs.title;e.value().length<6?e.valid(!1):e.valid(!0)},validateBody:function(){var e=viewModel.postToEditInputs.body;e.value().length<6?e.valid(!1):e.valid(!0)}},editPost:function(){var e=viewModel.postToEditInputs,t=e.title,o=e.body,a=[t,o],s=$("#editCategory").val();if(s.length<1)return $("#editCategory").css("border","1px solid red"),!1;for(var i in $("#editCategory").css("border","1px solid black"),a){var n=a[i];if(!0!==n.valid())return void n.valid(!1)}do_editPost({id:viewModel.postToEditInputs.id.value(),category_id:s,title:t.value(),body:o.value()})&&($(".modal").modal("hide"),viewModel.successMessage("Edited Post successfully."))},fetchData:function(){null!=localStorage.getItem("access_token")&&(viewModel.getCategories(),viewModel.getPosts())},removeDataFromView:function(){viewModel.posts.removeAll(),viewModel.categories.removeAll()},removePost:function(e){do_deletePost(e.id)},removePostLocally:function(t){viewModel.posts.remove(function(e){return e.id==t})}};function do_signin(e){return fetch("http://18.221.127.237/auth",{body:JSON.stringify(e),cache:"no-cache",headers:{"content-type":"application/json"},method:"POST"}).then(function(e){200===e.status?e.json().then(function(e){var t=e.access_token;return viewModel.saveAccessToken(t),getUserInfo(e.user_id),viewModel.loggedinUser(!0),viewModel.successMessage("You are now loggedIn successfully!"),!0}):401===e.status?(alert("Sign in: Not Authorized to modify this content."),e.json().then(function(e){var t=e.description+", Please try again!";return console.log(t),viewModel.failuerMessage(e.description),!1})):500===e.status&&(alert("Internal server error, Please try again later."),e.json().then(function(e){return viewModel.failuerMessage(e.description),!1}))})}function getUserInfo(e){fetch("http://18.221.127.237/user_id/"+e,{cache:"no-cache",headers:{authorization:"JWT "+localStorage.getItem("access_token")},method:"GET"}).then(function(e){200===e.status?e.json().then(function(e){return localStorage.setItem("username",e.username),viewModel.username(e.username),!0}):401===e.status?(alert("Not Authorized to modify this content."),e.json().then(function(e){e.description;return viewModel.failuerMessage(e.description),!1})):500===e.status&&(alert("Internal server error, Please try again later."),e.json().then(function(e){return viewModel.failuerMessage(e.description),!1}))})}function do_signup(e){return fetch("http://18.221.127.237/user/register",{body:JSON.stringify(e),cache:"no-cache",headers:{"content-type":"application/json"},method:"POST"}).then(function(e){201===e.status?e.json().then(function(e){return viewModel.successMessage("You are now digned up, and may login successfully!"),!0}):401===e.status?(alert("Not Authorized to modify this content."),e.json().then(function(e){e.description;return viewModel.failuerMessage(e.description),!1})):500===e.status&&(alert("Internal server error, Please try again later."),e.json().then(function(e){return viewModel.failuerMessage(e.description),!1}))})}function GsignInCallback(e){var t={code:e.code};fetch("http://18.221.127.237/login",{method:"POST",headers:{Accept:"application/json","Content-Type":"appication/json"},body:JSON.stringify(t),cache:"no-cache"}).then(function(e){return e.json()}).then(function(e){do_signin({email:e.email,password:"default_password"}),$(".modal").modal("hide")})}function do_addPost(e){return fetch("http://18.221.127.237/post/add",{body:JSON.stringify(e),cache:"no-cache",headers:{"content-type":"application/json",authorization:"JWT "+localStorage.getItem("access_token")},method:"POST"}).then(function(e){401===e.status&&e.json().then(function(e){return viewModel.failuerMessage(e.message),!1}),e.json().then(function(e){return viewModel.successMessage(e.message),do_getPosts(),!0})})}function do_getPosts(){fetch("http://18.221.127.237/posts",{headers:{Authorization:"JWT "+localStorage.getItem("access_token")}}).then(function(e){if(200!==e.status)return alert("An error has ocurred, Please try again later."),void e.json().then(function(e){viewModel.failuerMessage(e.message)});e.json().then(function(e){viewModel.posts(e.posts),viewModel.posts.reverse()})}).catch(function(e){alert("An error has ocurred, Please try again later."),console.log("Fetch Error :-S",e)})}function do_deletePost(t){fetch("http://18.221.127.237/post/"+t,{headers:{Authorization:"JWT "+localStorage.getItem("access_token")},method:"DELETE"}).then(function(e){return 401==e.status?(viewModel.failuerMessage("Not Authorized to remove this post."),!1):500===e.status?(viewModel.failuerMessage("Something went wrong, please try again later"),!1):void(200===e.status?e.json().then(function(e){return viewModel.removePostLocally(t),!0}):alert("An error has ocurred, Please try again later."))})}function do_editPost(e){fetch("http://18.221.127.237/post/"+e.id,{headers:{"content-type":"application/json",Authorization:"JWT "+localStorage.getItem("access_token")},method:"PUT",body:JSON.stringify({category_id:e.category_id,title:e.title,body:e.body})}).then(function(e){return 401==e.status?(alert("Not Authorized to modify this content."),viewModel.failuerMessage("Not Authorized to edit this post."),!1):500===e.status?(alert("Internal server error, Please try again later."),viewModel.failuerMessage("Something went wrong, please try again later"),!1):void(200===e.status?e.json().then(function(e){return do_getPosts(),$(".modal").modal("hide"),!0}):alert("An error has ocurred, Please try again later."))})}ko.applyBindings(viewModel);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsidmlld01vZGVsIiwicG9zdHMiLCJrbyIsIm9ic2VydmFibGVBcnJheSIsImZpbHRlcmVkUG9zdHMiLCJjYXRlZ29yaWVzIiwiZ2V0SXRlbSIsImxvZ2dlZGluVXNlciIsIm9ic2VydmFibGUiLCJ1c2VybmFtZSIsImZhaWx1ZXJNZXNzYWdlIiwibG9jYWxTdG9yYWdlIiwiY2hlY2tMb2dnZWRpblVzZXIiLCJzaWduaW4iLCJpbnB1dHMiLCJzaWduaW5JbnB1dHMiLCJlbWFpbCIsInBhc3N3b3JkIiwiaSIsImVsZW1lbnRzQXJyYXkiLCJlbGVtZW50IiwidmFsaWQiLCJ2YWx1ZSIsImRvX3NpZ25pbiIsInVzZXIiLCJmZXRjaERhdGEiLCJ2YWxpZGF0ZVNpZ25pbklucHV0cyIsInZhbGlkYXRlRW1haWwiLCJsZW5ndGgiLCJpbmRleE9mIiwidmFsaWRhdGVQYXNzd29yZCIsInNhdmVBY2Nlc3NUb2tlbiIsImFjY2Vzc190b2tlbiIsInNldEl0ZW0iLCJzaWdudXAiLCJzaWdudXBJbnB1dHMiLCIkIiwibW9kYWwiLCJkb19zaWdudXAiLCJ2YWxpZGF0ZVNpZ251cElucHV0cyIsInZhbGlkYXRlVXNlcm5hbWUiLCJzaWdub3V0IiwicmVtb3ZlSXRlbSIsInJlbW92ZURhdGFGcm9tVmlldyIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwiZ2V0Q2F0ZWdvcmllcyIsInN0YXR1cyIsImFsZXJ0IiwiZGF0YSIsIm1lc3NhZ2UiLCJqc29uIiwiY2F0Y2giLCJlcnIiLCJsb2ciLCJnZXRQb3N0cyIsImRvX2dldFBvc3RzIiwiZmlsdGVyUG9zdHMiLCJmaWx0ZXIiLCJwb3N0IiwiY2F0ZWdvcnlfaWQiLCJpZCIsInJlbW92ZUFsbCIsImFkZFBvc3QiLCJhZGRQb3N0SW5wdXRzIiwidGl0bGUiLCJjYXRlZ29yeVZhbHVlIiwidmFsIiwiZ2V0RGF0YSIsImJvZHlWYWx1ZSIsImNzcyIsImJvZHkiLCJjYXRlZ29yeSIsInZhbGlkYXRlQWRkUG9zdElucHV0cyIsInZhbGlkYXRlQ2F0ZWdvcnkiLCJ2YWxpZGF0ZVRpdGxlIiwidmFsaWRhdGVCb2R5Iiwic2V0UG9zdFRvRWRpdCIsImV2ZW50IiwicG9zdFRvRWRpdElucHV0cyIsInZhbGlkYXRlUG9zdFRvRWRpdElucHV0cyIsImVkaXRQb3N0IiwicG9zdF9pZCIsInN1Y2Nlc3NNZXNzYWdlIiwicmVtb3ZlUG9zdCIsIml0ZW0iLCJkb19kZWxldGVQb3N0IiwiSlNPTiIsInN0cmluZ2lmeSIsImNhY2hlIiwiaGVhZGVycyIsInVzZXJfaWQiLCJnZXRVc2VySW5mbyIsImRlc2NyaXB0aW9uIiwibWV0aG9kIiwiY29udGVudC10eXBlIiwiR3NpZ25JbkNhbGxiYWNrIiwiY29kZSIsImF1dGhSZXN1bHQiLCJBY2NlcHQiLCJDb250ZW50LVR5cGUiLCJkb19hZGRQb3N0IiwiQXV0aG9yaXphdGlvbiIsImNvbnNvbGUiLCJyZXZlcnNlIiwiZG9fZWRpdFBvc3QiLCJyZW1vdmVQb3N0TG9jYWxseSIsImFwcGx5QmluZGluZ3MiXSwibWFwcGluZ3MiOiJhQUNBLElBQUlBLFVBQVksQ0FEaEJDLE1BQUFDLEdBQUFDLGtCQUNJSCxjQUFZRSxHQUFBQyxrQkFDWkYsV0FBVUUsR0FBQUEsa0JBQ1ZDLGFBQUFBLEdBQWVGLGFBQ2ZHLFNBQUFBLEdBQVlILFdBQUdDLGFBSEhHLFFBQUEsYUFJWkMsZUFBY0wsR0FBR00sYUFDakJDLGVBQWFELEdBQUFBLGFBRWJFLGtCQUFtQkYsV0FHNkIsTUFBeENHLGFBQWFMLFFBQVEsZ0JBRDdCTSxVQUFBQSxjQUFtQixHQUNmWixVQUdLTyxjQUFBLElBS1RNLE9BQVEsV0FBUkEsSUFBUUMsRUFBQWQsVUFBTWUsYUFDSkQsRUFBbUJDLEVBQW5CRCxNQUFTZCxFQUFVZSxFQUFWZixTQUNQZ0IsRUFBQUEsQ0FGRUEsRUFBQUMsR0FLVixJQUFNLElBQUlDLEtBQUtDLEVBQWUsQ0FGeEJBLElBQUFBLEVBQUFBLEVBQXlCRixHQUkzQixJQUF5QixJQUFwQkcsRUFBUUMsUUFE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RUFBU0UsT0FBVEgsS0FBbUIsU0FBdkJLLEdBRUlsRCxPQURBaUQsVUFBTTBELGtCQUFBeEIsSUFDSXpFLElBS1ZWLE1BQUFBLG9EQU1Jb0MsU0FBQUEsWUFBRXdCLEdBQ0ZoQixNQUFBQSw4QkFBQWdCLEVBQUFFLEdBQUEsQ0FDSDZCLFFBSkQsQ0FEQ0ssZUFPQSxtQkFDRC9DLGNBQUFBLE9BQU10QyxhQUFBTCxRQUFBLGlCQTNCZHlGLE9BQUEsTUE4Qkh2QixLQUFBZ0IsS0FBQUMsVUFBQSxDQUFBNUIsWUFBQUQsRUFBQUMsWUFBQUssTUFBQU4sRUFBQU0sTUFBQU0sS0FBQVosRUFBQVksU0FFRW9DLEtBQUFBLFNBQUFBLEdBdkJLLE9BQXVCLEtBQW5COUQsRUFBU0UsUUFDVEMsTUFBTSwwQ0FDTmpELFVBQVVVLGVBQWUsc0NBQ2xCLEdBRWtCLE1BQXBCb0MsRUFBU0UsUUFDZEMsTUFBTSxrREFDTmpELFVBQVVVLGVBQWUsaURBQ2xCLFFBRWtCLE1BQXBCb0MsRUFBU0UsT0FDZEYsRUFBU00sT0FBT1AsS0FBSyxTQUFDSyxHQUdsQixPQUZBTyxjQUNBckIsRUFBRSxVQUFVQyxNQUFNLFNBQ1gsSUFJWFksTUFBTSxvREFLbEIvQyxHQUFHMEcsY0FBYzVHIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBLbm9ja291dCBkYXRhIGJpbmRpbmcgYW5kIHRlbXBsYXRpbmcgKi9cbnZhciB2aWV3TW9kZWwgPSB7XG4gICAgcG9zdHM6IGtvLm9ic2VydmFibGVBcnJheSgpLFxuICAgIGZpbHRlcmVkUG9zdHM6IGtvLm9ic2VydmFibGVBcnJheSgpLFxuICAgIGNhdGVnb3JpZXM6IGtvLm9ic2VydmFibGVBcnJheSgpLFxuICAgIGxvZ2dlZGluVXNlcjoga28ub2JzZXJ2YWJsZSgpLFxuICAgIHVzZXJuYW1lOiBrby5vYnNlcnZhYmxlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VybmFtZScpKSxcbiAgICBzdWNjZXNzTWVzc2FnZToga28ub2JzZXJ2YWJsZSgpLFxuICAgIGZhaWx1ZXJNZXNzYWdlOiBrby5vYnNlcnZhYmxlKCksXG5cbiAgICBjaGVja0xvZ2dlZGluVXNlcjogKCkgPT4ge1xuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5sb2dnZWRpblVzZXIodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2aWV3TW9kZWwubG9nZ2VkaW5Vc2VyKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzaWduaW46ICgpID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gdmlld01vZGVsLnNpZ25pbklucHV0cztcbiAgICAgICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IGlucHV0cztcbiAgICAgICAgY29uc3QgZWxlbWVudHNBcnJheSA9IFsgZW1haWwsIHBhc3N3b3JkIF07XG4gICAgICAgIFxuICAgICAgICBmb3IgKCBsZXQgaSBpbiBlbGVtZW50c0FycmF5ICl7XG4gICAgICAgICAgICBsZXQgZWxlbWVudCA9IGVsZW1lbnRzQXJyYXlbaV07XG4gICAgICAgICAgICBpZiAoIGVsZW1lbnQudmFsaWQoKSAhPT0gdHJ1ZSApIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnZhbGlkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHVzZXIgPSB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwudmFsdWUoKSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZC52YWx1ZSgpXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmKCBkb19zaWduaW4odXNlcikgKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGNsZWFyIHRoZSBtb2RhbCBmb3JtIGFuZCBoaWRlIGl0XG4gICAgICAgICAgICAkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpO1xuICAgICAgICAgICAgdmlld01vZGVsLmZldGNoRGF0YSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgICAvKiBWYWx1ZXMgb2YgdGhlIFNpZ25pbiBmb3JtICovXG4gICAgIHNpZ25pbklucHV0czoge1xuICAgICAgICBlbWFpbCA6IHtcbiAgICAgICAgICAgIHZhbHVlOiBrby5vYnNlcnZhYmxlKCcnKSxcbiAgICAgICAgICAgIHZhbGlkOiBrby5vYnNlcnZhYmxlKClcbiAgICAgICAgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHtcbiAgICAgICAgICAgIHZhbHVlOiBrby5vYnNlcnZhYmxlKCcnKSxcbiAgICAgICAgICAgIHZhbGlkOiBrby5vYnNlcnZhYmxlKClcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBBIFNFVCBPRiBGVU5DVElPTlMgVE8gVkFMSURBVEUgRUFDSCBJTlBVVCBGSUVMRCBcbiAgICB2YWxpZGF0ZVNpZ25pbklucHV0czoge1xuICAgICAgICB2YWxpZGF0ZUVtYWlsOiAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZW1haWwgPSB2aWV3TW9kZWwuc2lnbmluSW5wdXRzLmVtYWlsO1xuXG4gICAgICAgICAgICBpZiAoIGVtYWlsLnZhbHVlKCkubGVuZ3RoIDwgNiB8fCBlbWFpbC52YWx1ZSgpLmluZGV4T2YoJ0AnKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgIGVtYWlsLnZhbGlkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbWFpbC52YWxpZCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSxcbiAgICAgICAgdmFsaWRhdGVQYXNzd29yZDogKCkgPT4ge1xuICAgICAgICAgICAgbGV0IHBhc3N3b3JkID0gdmlld01vZGVsLnNpZ25pbklucHV0cy5wYXNzd29yZDtcblxuICAgICAgICAgICAgaWYgKCBwYXNzd29yZC52YWx1ZSgpLmxlbmd0aCA8IDYgfHwgcGFzc3dvcmQudmFsdWUoKS5pbmRleE9mKCcgJykgIT0gLTEpe1xuICAgICAgICAgICAgICAgIHBhc3N3b3JkLnZhbGlkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXNzd29yZC52YWxpZCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBBIGZ1bmN0aW9uIHRvIGhhbmRsZSBhbmQgc3RvcmUgdGhlIGFjY2Vzc190b2tlblxuICAgIHNhdmVBY2Nlc3NUb2tlbjogKGFjY2Vzc190b2tlbikgPT4ge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYWNjZXNzX3Rva2VuJywgYWNjZXNzX3Rva2VuKTtcbiAgICAgICAgdmlld01vZGVsLmZldGNoRGF0YSgpO1xuXG4gICAgfSxcbiAgICBcblxuICAgIC8vIFNpZ25VcCBmdW5jdGlvbnNcbiAgICBzaWdudXA6ICgpID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gdmlld01vZGVsLnNpZ251cElucHV0cztcbiAgICAgICAgY29uc3QgeyB1c2VybmFtZSwgZW1haWwsIHBhc3N3b3JkIH0gPSBpbnB1dHM7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzQXJyYXkgPSBbIHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQgXTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoIGxldCBpIGluIGVsZW1lbnRzQXJyYXkgKXtcbiAgICAgICAgICAgIGxldCBlbGVtZW50ID0gZWxlbWVudHNBcnJheVtpXTtcbiAgICAgICAgICAgIGlmICggZWxlbWVudC52YWxpZCgpICE9PSB0cnVlICkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmFsaWQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgdXNlciA9IHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZS52YWx1ZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLnZhbHVlKCksXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudmFsdWUoKVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgaWYoIGRvX3NpZ251cCh1c2VyKSApIHtcbiAgICAgICAgICAgIC8vc2lnbiB0aGUgdXNlciBpblxuICAgICAgICAgICAgbGV0IHVzZXJUb0xvZ2luID0geydlbWFpbCc6IHVzZXIuZW1haWwsICdwYXNzd29yZCc6IHVzZXIucGFzc3dvcmR9O1xuICAgICAgICAgICAgJCgnLm1vZGFsJykubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5zdWNjZXNzTWVzc2FnZSgnWW91IGFyZSBub3cgZGlnbmVkIHVwLCBhbmQgY2FuIGxvZ2luLi4nKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAgLyogVmFsdWVzIG9mIHRoZSBTaWdudXAgZm9ybSAqL1xuICAgICBzaWdudXBJbnB1dHM6IHtcbiAgICAgICAgdXNlcm5hbWUgOiB7XG4gICAgICAgICAgICB2YWx1ZToga28ub2JzZXJ2YWJsZSgnJyksXG4gICAgICAgICAgICB2YWxpZDoga28ub2JzZXJ2YWJsZSgpXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsIDoge1xuICAgICAgICAgICAgdmFsdWU6IGtvLm9ic2VydmFibGUoJycpLFxuICAgICAgICAgICAgdmFsaWQ6IGtvLm9ic2VydmFibGUoKVxuICAgICAgICB9LFxuICAgICAgICBwYXNzd29yZDoge1xuICAgICAgICAgICAgdmFsdWU6IGtvLm9ic2VydmFibGUoJycpLFxuICAgICAgICAgICAgdmFsaWQ6IGtvLm9ic2VydmFibGUoKVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8vIEEgU0VUIE9GIEZVTkNUSU9OUyBUTyBWQUxJREFURSBFQUNIIElOUFVUIEZJRUxEIFxuICAgIHZhbGlkYXRlU2lnbnVwSW5wdXRzOiB7XG4gICAgICAgIHZhbGlkYXRlVXNlcm5hbWU6ICgpID0+IHtcbiAgICAgICAgICAgIGxldCB1c2VybmFtZSA9IHZpZXdNb2RlbC5zaWdudXBJbnB1dHMudXNlcm5hbWU7XG5cbiAgICAgICAgICAgIGlmICggdXNlcm5hbWUudmFsdWUoKS5sZW5ndGggPCAyICkge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lLnZhbGlkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1c2VybmFtZS52YWxpZCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSxcbiAgICAgICAgdmFsaWRhdGVFbWFpbDogKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGVtYWlsID0gdmlld01vZGVsLnNpZ251cElucHV0cy5lbWFpbDtcblxuICAgICAgICAgICAgaWYgKCBlbWFpbC52YWx1ZSgpLmxlbmd0aCA8IDYgfHwgZW1haWwudmFsdWUoKS5pbmRleE9mKCdAJykgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBlbWFpbC52YWxpZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZW1haWwudmFsaWQodHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICAgIHZhbGlkYXRlUGFzc3dvcmQ6ICgpID0+IHtcbiAgICAgICAgICAgIGxldCBwYXNzd29yZCA9IHZpZXdNb2RlbC5zaWdudXBJbnB1dHMucGFzc3dvcmQ7XG5cbiAgICAgICAgICAgIGlmICggcGFzc3dvcmQudmFsdWUoKS5sZW5ndGggPCA2IHx8IHBhc3N3b3JkLnZhbHVlKCkuaW5kZXhPZignICcpICE9IC0xKXtcbiAgICAgICAgICAgICAgICBwYXNzd29yZC52YWxpZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFzc3dvcmQudmFsaWQodHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gU2lnbm91dFxuICAgIHNpZ25vdXQ6ICgpID0+IHtcbiAgICAgICAgLy8gY2xlYXIgdGhlIGFjY2Vzc190b2tlbiBmcm9tIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjY2Vzc190b2tlbicpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlcm5hbWUnKTtcbiAgICAgICAgdmlld01vZGVsLnJlbW92ZURhdGFGcm9tVmlldygpO1xuICAgICAgICB2aWV3TW9kZWwubG9nZ2VkaW5Vc2VyKGZhbHNlKTtcbiAgICAgICAgdmlld01vZGVsLnVzZXJuYW1lKCcnKTtcblxuICAgIH0sXG5cbiAgICBnZXRDYXRlZ29yaWVzOiAoKSA9PiB7XG4gICAgICAgIGZldGNoKCdodHRwOi8vMTguMjIxLjEyNy4yMzcvY2F0ZWdvcmllcycpXG4gICAgICAgIC50aGVuKCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwICkge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiRXJyb3Igd2hpbGUgZmV0Y2hpbmcgZGF0YS5cIik7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oICggZGF0YSApID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsLmZhaWx1ZXJNZXNzYWdlKGRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgLy9hcHBlbmQgdGhlIG1vdmllcyB0byB0aGUgdmlld01vZGVsXG4gICAgICAgICAgICAgICAgdmlld01vZGVsLmNhdGVnb3JpZXMoZGF0YS5jYXRlZ29yaWVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goIGZ1bmN0aW9uKCBlcnIgKSB7XG4gICAgICAgICAgICBhbGVydChcIkVycm9yIHdoaWxlIGZldGNoaW5nIGRhdGEuXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIEVycm9yIDotUycsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBnZXRQb3N0czogKCkgPT4ge1xuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGRvX2dldFBvc3RzKCk7XG4gICAgfSxcblxuICAgIGZpbHRlclBvc3RzOiAoZGF0YSk9PiB7XG4gICAgICAgIGNvbnN0IHBvc3RzID0gdmlld01vZGVsLnBvc3RzKCk7XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkUG9zdHMgPSBwb3N0cy5maWx0ZXIocG9zdCA9PiBwb3N0LmNhdGVnb3J5X2lkID09IGRhdGEuaWQpO1xuICAgICAgICB2aWV3TW9kZWwuZmlsdGVyZWRQb3N0cyhmaWx0ZXJlZFBvc3RzKTtcbiAgICB9LFxuXG4gICAgY2xlYXJGaWx0ZXI6ICgpID0+IHtcbiAgICAgICAgdmlld01vZGVsLmZpbHRlcmVkUG9zdHMucmVtb3ZlQWxsKCk7XG4gICAgfSxcblxuICAgIC8vIFNpZ25VcCBmdW5jdGlvbnNcbiAgICBhZGRQb3N0OiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IHZpZXdNb2RlbC5hZGRQb3N0SW5wdXRzO1xuICAgICAgICBjb25zdCB7IHRpdGxlIH0gPSBpbnB1dHM7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzQXJyYXkgPSBbdGl0bGUgXTtcbiAgICAgICAgXG4gICAgICAgIC8vIHZhbGlkYXRlIHRoZSBjYXRlZ29yeSBpbnB1dFxuICAgICAgICBsZXQgY2F0ZWdvcnlWYWx1ZSA9ICQoJyNjYXRlZ29yeScpLnZhbCgpO1xuICAgICAgICBsZXQgYm9keVZhbHVlID0gQ0tFRElUT1IuaW5zdGFuY2VzWydhZGRQb3N0Qm9keSddLmdldERhdGEoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIHZhbGlkYXRlIGNhdGVnb3J5XG4gICAgICAgIGlmICggY2F0ZWdvcnlWYWx1ZS5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vdmFsaWRhdGUgYm9keVxuICAgICAgICBpZiAoYm9keVZhbHVlLmxlbmd0aCA8IDIwKSB7XG4gICAgICAgICAgICAkKFwiI2FkZFBvc3RCb2R5XCIpLmNzcygnYm9yZGVyJywgJzFweCBzb2xpZCByZWQnKTtcbiAgICAgICAgICAgIGlucHV0cy5ib2R5LnZhbGlkKGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlucHV0cy5ib2R5LnZhbGlkKHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmFsaWRhdGUgdGl0bGVcbiAgICAgICAgZm9yICggbGV0IGkgaW4gZWxlbWVudHNBcnJheSApe1xuICAgICAgICAgICAgbGV0IGVsZW1lbnQgPSBlbGVtZW50c0FycmF5W2ldO1xuICAgICAgICAgICAgaWYgKCBlbGVtZW50LnZhbGlkKCkgIT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWxpZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBsZXQgbmV3UG9zdCA9IHtcbiAgICAgICAgICAgIGNhdGVnb3J5X2lkOiBjYXRlZ29yeVZhbHVlLFxuICAgICAgICAgICAgdGl0bGU6IHRpdGxlLnZhbHVlKCksXG4gICAgICAgICAgICBib2R5OmJvZHlWYWx1ZVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgaWYoIGRvX2FkZFBvc3QobmV3UG9zdCkgKSB7XG4gICAgICAgICAgICAvLyBBZGQgdGhlIHBvc3QgbG9jYWxseVxuICAgICAgICAgICAgYm9keVZhbHVlID0gJyc7XG4gICAgICAgICAgICB0aXRsZS52YWx1ZSgnJyk7XG5cbiAgICAgICAgICAgICQoJy5tb2RhbCcpLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgICAgICB2aWV3TW9kZWwuZ2V0UG9zdHMoKTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5zdWNjZXNzTWVzc2FnZSgnQWRkZWQgUG9zdCBzdWNjZXNzZnVsbHkuJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgIC8qIFZhbHVlcyBvZiB0aGUgYWRkUG9zdCBmb3JtICovXG4gICAgIGFkZFBvc3RJbnB1dHM6IHtcbiAgICAgICAgY2F0ZWdvcnkgOiB7XG4gICAgICAgICAgICB2YWx1ZToga28ub2JzZXJ2YWJsZSgnJyksXG4gICAgICAgICAgICB2YWxpZDoga28ub2JzZXJ2YWJsZSgpXG4gICAgICAgIH0sXG4gICAgICAgIHRpdGxlIDoge1xuICAgICAgICAgICAgdmFsdWU6IGtvLm9ic2VydmFibGUoJycpLFxuICAgICAgICAgICAgdmFsaWQ6IGtvLm9ic2VydmFibGUoKVxuICAgICAgICB9LFxuICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICB2YWx1ZToga28ub2JzZXJ2YWJsZSgnJyksXG4gICAgICAgICAgICB2YWxpZDoga28ub2JzZXJ2YWJsZSgpXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gQSBTRVQgT0YgRlVOQ1RJT05TIFRPIFZBTElEQVRFIEVBQ0ggSU5QVVQgRklFTEQgXG4gICAgdmFsaWRhdGVBZGRQb3N0SW5wdXRzOiB7XG4gICAgICAgIHZhbGlkYXRlQ2F0ZWdvcnk6ICgpID0+IHtcbiAgICAgICAgICAgIGxldCBjYXRlZ29yeSA9IHZpZXdNb2RlbC5hZGRQb3N0SW5wdXRzLmNhdGVnb3J5O1xuICAgICAgICAgICAgaWYgKCBjYXRlZ29yeS52YWx1ZSgpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgdmFsaWQudmFsaWQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGVnb3J5LnZhbGlkKHRydWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9LFxuICAgICAgICB2YWxpZGF0ZVRpdGxlOiAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgdGl0bGUgPSB2aWV3TW9kZWwuYWRkUG9zdElucHV0cy50aXRsZTtcblxuICAgICAgICAgICAgaWYgKCB0aXRsZS52YWx1ZSgpLmxlbmd0aCA8IDYpIHtcbiAgICAgICAgICAgICAgICB0aXRsZS52YWxpZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGl0bGUudmFsaWQodHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICAgIHZhbGlkYXRlQm9keTogKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGJvZHkgPSB2aWV3TW9kZWwuYWRkUG9zdElucHV0cy5ib2R5O1xuICAgICAgICAgICAgYm9keS52YWxpZCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRQb3N0VG9FZGl0OiAoZGF0YSwgZXZlbnQpID0+IHtcbiAgICAgICAgbGV0IGlucHV0cyA9IHZpZXdNb2RlbC5wb3N0VG9FZGl0SW5wdXRzO1xuICAgICAgICBpbnB1dHMuaWQudmFsdWUoZGF0YS5pZCk7XG4gICAgICAgIGlucHV0cy5jYXRlZ29yeS52YWx1ZShkYXRhLmNhdGVnb3J5KTtcbiAgICAgICAgaW5wdXRzLnRpdGxlLnZhbHVlKGRhdGEudGl0bGUpO1xuICAgICAgICBpbnB1dHMuYm9keS52YWx1ZShkYXRhLmJvZHkpO1xuICAgIH0sXG5cbiAgICBwb3N0VG9FZGl0SW5wdXRzOiB7XG4gICAgICAgIGlkOiB7XG4gICAgICAgICAgICB2YWx1ZToga28ub2JzZXJ2YWJsZSgnJylcbiAgICAgICAgfSxcbiAgICAgICAgY2F0ZWdvcnkgOiB7XG4gICAgICAgICAgICB2YWx1ZToga28ub2JzZXJ2YWJsZSgnJyksXG4gICAgICAgICAgICB2YWxpZDoga28ub2JzZXJ2YWJsZSgpXG4gICAgICAgIH0sXG4gICAgICAgIHRpdGxlIDoge1xuICAgICAgICAgICAgdmFsdWU6IGtvLm9ic2VydmFibGUoJycpLFxuICAgICAgICAgICAgdmFsaWQ6IGtvLm9ic2VydmFibGUodHJ1ZSlcbiAgICAgICAgfSxcbiAgICAgICAgYm9keToge1xuICAgICAgICAgICAgdmFsdWU6IGtvLm9ic2VydmFibGUoJycpLFxuICAgICAgICAgICAgdmFsaWQ6IGtvLm9ic2VydmFibGUodHJ1ZSlcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBBIFNFVCBPRiBGVU5DVElPTlMgVE8gVkFMSURBVEUgRUFDSCBJTlBVVCBGSUVMRCBcbiAgICB2YWxpZGF0ZVBvc3RUb0VkaXRJbnB1dHM6IHtcbiAgICAgICAgdmFsaWRhdGVDYXRlZ29yeTogKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGNhdGVnb3J5ID0gdmlld01vZGVsLnBvc3RUb0VkaXRJbnB1dHMuY2F0ZWdvcnk7XG4gICAgICAgICAgICBpZiAoIGNhdGVnb3J5LnZhbHVlKCkubGVuZ3RoID4gMCApIHtcbiAgICAgICAgICAgICAgICB2YWxpZC52YWxpZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0ZWdvcnkudmFsaWQodHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICAgIHZhbGlkYXRlVGl0bGU6ICgpID0+IHtcbiAgICAgICAgICAgIGxldCB0aXRsZSA9IHZpZXdNb2RlbC5wb3N0VG9FZGl0SW5wdXRzLnRpdGxlO1xuXG4gICAgICAgICAgICBpZiAoIHRpdGxlLnZhbHVlKCkubGVuZ3RoIDwgNikge1xuICAgICAgICAgICAgICAgIHRpdGxlLnZhbGlkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aXRsZS52YWxpZCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSxcbiAgICAgICAgdmFsaWRhdGVCb2R5OiAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgYm9keSA9IHZpZXdNb2RlbC5wb3N0VG9FZGl0SW5wdXRzLmJvZHk7XG5cbiAgICAgICAgICAgIGlmICggYm9keS52YWx1ZSgpLmxlbmd0aCA8IDYpe1xuICAgICAgICAgICAgICAgIGJvZHkudmFsaWQoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJvZHkudmFsaWQodHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZWRpdFBvc3Q6ICgpID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXRzID0gdmlld01vZGVsLnBvc3RUb0VkaXRJbnB1dHM7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIGJvZHkgfSA9IGlucHV0cztcbiAgICAgICAgY29uc3QgZWxlbWVudHNBcnJheSA9IFt0aXRsZSxib2R5XTtcbiAgICAgICAgXG4gICAgICAgIC8vIHZhbGlkYXRlIHRoZSBjYXRlZ29yeSBpbnB1dFxuICAgICAgICBsZXQgY2F0ZWdvcnlWYWx1ZSA9ICQoJyNlZGl0Q2F0ZWdvcnknKS52YWwoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIHZhbGlkYXRlIGNhdGVnb3J5XG4gICAgICAgIGlmICggY2F0ZWdvcnlWYWx1ZS5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICAkKCcjZWRpdENhdGVnb3J5JykuY3NzKCdib3JkZXInLCAnMXB4IHNvbGlkIHJlZCcpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJCgnI2VkaXRDYXRlZ29yeScpLmNzcygnYm9yZGVyJywgJzFweCBzb2xpZCBibGFjaycpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdmFsaWRhdGUgdGl0bGUgYW5kIGJvZHlcbiAgICAgICAgZm9yICggbGV0IGkgaW4gZWxlbWVudHNBcnJheSApe1xuICAgICAgICAgICAgbGV0IGVsZW1lbnQgPSBlbGVtZW50c0FycmF5W2ldO1xuICAgICAgICAgICAgaWYgKCBlbGVtZW50LnZhbGlkKCkgIT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52YWxpZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBwb3N0X2lkID0gdmlld01vZGVsLnBvc3RUb0VkaXRJbnB1dHMuaWQudmFsdWUoKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBwb3N0VG9FZGl0ID0ge1xuICAgICAgICAgICAgaWQ6IHBvc3RfaWQsXG4gICAgICAgICAgICBjYXRlZ29yeV9pZDogY2F0ZWdvcnlWYWx1ZSxcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZS52YWx1ZSgpLFxuICAgICAgICAgICAgYm9keTpib2R5LnZhbHVlKClcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGlmKCBkb19lZGl0UG9zdChwb3N0VG9FZGl0KSApIHtcbiAgICAgICAgICAgIC8vIGVkaXQgdGhlIHBvc3QgbG9jYWxseVxuICAgICAgICAgICAgJCgnLm1vZGFsJykubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5zdWNjZXNzTWVzc2FnZSgnRWRpdGVkIFBvc3Qgc3VjY2Vzc2Z1bGx5LicpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGZldGNoRGF0YTogKCkgPT4ge1xuICAgICAgICBpZiAoIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmlld01vZGVsLmdldENhdGVnb3JpZXMoKTtcbiAgICAgICAgdmlld01vZGVsLmdldFBvc3RzKCk7XG4gICAgfSxcblxuICAgIHJlbW92ZURhdGFGcm9tVmlldzogKCkgPT4ge1xuICAgICAgICB2aWV3TW9kZWwucG9zdHMucmVtb3ZlQWxsKCk7XG4gICAgICAgIHZpZXdNb2RlbC5jYXRlZ29yaWVzLnJlbW92ZUFsbCgpO1xuICAgIH0sXG5cbiAgICByZW1vdmVQb3N0OiAoZGF0YSkgPT4ge1xuICAgICAgICBsZXQgcG9zdF9pZCA9IGRhdGEuaWQ7XG4gICAgICAgIGRvX2RlbGV0ZVBvc3QocG9zdF9pZCk7XG4gICAgfSxcblxuICAgIHJlbW92ZVBvc3RMb2NhbGx5OiAocG9zdF9pZCkgPT4ge1xuICAgICAgICB2aWV3TW9kZWwucG9zdHMucmVtb3ZlKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbS5pZCA9PSBwb3N0X2lkO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiBFTkQgKi8gICBcbn07XG5cbi8qIFxuICAgIFRIRSBORVhUIFNFVCBPRiBNRVRIT0RTIEFSRSBUSEUgQUNUVUFMIEFQSSBDQUxMUyBcbiAgICAgICAgICAgICAgICBVU0lORyBGRVRDSCBBUElcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4qL1xuXG4vKiBGZXRjaCBQT1NUIFJlcXVpZXN0IHRvIHRvIHRoZSBSRVNUIEFQSSAqL1xuZnVuY3Rpb24gZG9fc2lnbmluKHVzZXIpIHtcbiAgICByZXR1cm4gZmV0Y2goYGh0dHA6Ly8xOC4yMjEuMTI3LjIzNy9hdXRoYCwge1xuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh1c2VyKSxcbiAgICAgICAgY2FjaGU6ICduby1jYWNoZScsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOiAnUE9TVCdcbiAgICB9KVxuICAgIC50aGVuKCAoIHJlc3BvbnNlICkgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKCAoIGRhdGEgKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGFjY2Vzc190b2tlbiA9IGRhdGEuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5zYXZlQWNjZXNzVG9rZW4oYWNjZXNzX3Rva2VuKTtcbiAgICAgICAgICAgICAgICBnZXRVc2VySW5mbyhkYXRhLnVzZXJfaWQpO1xuICAgICAgICAgICAgICAgIC8vIHNpZ25hbCB0aGF0IGEgdXNlciBpcyBpblxuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5sb2dnZWRpblVzZXIodHJ1ZSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnN1Y2Nlc3NNZXNzYWdlKCdZb3UgYXJlIG5vdyBsb2dnZWRJbiBzdWNjZXNzZnVsbHkhJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggcmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgKSB7XG4gICAgICAgICAgICBhbGVydChcIlNpZ24gaW46IE5vdCBBdXRob3JpemVkIHRvIG1vZGlmeSB0aGlzIGNvbnRlbnQuXCIpO1xuICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oICggZGF0YSApID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IGAke2RhdGEuZGVzY3JpcHRpb259LCBQbGVhc2UgdHJ5IGFnYWluIWA7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSlcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwuZmFpbHVlck1lc3NhZ2UoZGF0YS5kZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggcmVzcG9uc2Uuc3RhdHVzID09PSA1MDAgKSB7XG4gICAgICAgICAgICBhbGVydChcIkludGVybmFsIHNlcnZlciBlcnJvciwgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIik7XG4gICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbiggKCBkYXRhICkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gYHNlcnZlciBlcnJvciwgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlciFgO1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5mYWlsdWVyTWVzc2FnZShkYXRhLmRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0VXNlckluZm8odXNlcl9pZCkge1xuICAgIGZldGNoKGBodHRwOi8vMTguMjIxLjEyNy4yMzcvdXNlcl9pZC8ke3VzZXJfaWR9YCwge1xuICAgICAgICBjYWNoZTogJ25vLWNhY2hlJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2F1dGhvcml6YXRpb24nOiBgSldUICR7bG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpfWBcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgIH0pXG4gICAgLnRoZW4oICggcmVzcG9uc2UgKSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oICggZGF0YSApID0+IHtcbiAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHVzZXIgdXNlcm5hbWUgdG8gdGhlIGxvY2FsU3RvcmFnZVxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VybmFtZScsIGRhdGEudXNlcm5hbWUpO1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC51c2VybmFtZShkYXRhLnVzZXJuYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxICkge1xuICAgICAgICAgICAgYWxlcnQoXCJOb3QgQXV0aG9yaXplZCB0byBtb2RpZnkgdGhpcyBjb250ZW50LlwiKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKCAoIGRhdGEgKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBgJHtkYXRhLmRlc2NyaXB0aW9ufSwgUGxlYXNlIHRyeSBhZ2FpbiFgO1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5mYWlsdWVyTWVzc2FnZShkYXRhLmRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCByZXNwb25zZS5zdGF0dXMgPT09IDUwMCApIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiSW50ZXJuYWwgc2VydmVyIGVycm9yLCBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKCAoIGRhdGEgKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBgc2VydmVyIGVycm9yLCBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyIWA7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLmZhaWx1ZXJNZXNzYWdlKGRhdGEuZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBkb19zaWdudXAodXNlcikge1xuICAgIHJldHVybiBmZXRjaChgaHR0cDovLzE4LjIyMS4xMjcuMjM3L3VzZXIvcmVnaXN0ZXJgLCB7XG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHVzZXIpLFxuICAgICAgICBjYWNoZTogJ25vLWNhY2hlJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICB9LFxuICAgICAgICBtZXRob2Q6ICdQT1NUJ1xuICAgIH0pXG4gICAgLnRoZW4oICggcmVzcG9uc2UgKSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMSkge1xuICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oICggZGF0YSApID0+IHtcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwuc3VjY2Vzc01lc3NhZ2UoJ1lvdSBhcmUgbm93IGRpZ25lZCB1cCwgYW5kIG1heSBsb2dpbiBzdWNjZXNzZnVsbHkhJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCByZXNwb25zZS5zdGF0dXMgPT09IDQwMSApIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiTm90IEF1dGhvcml6ZWQgdG8gbW9kaWZ5IHRoaXMgY29udGVudC5cIik7XG4gICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbiggKCBkYXRhICkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gYCR7ZGF0YS5kZXNjcmlwdGlvbn0sIFBsZWFzZSB0cnkgYWdhaW4hYDtcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwuZmFpbHVlck1lc3NhZ2UoZGF0YS5kZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICggcmVzcG9uc2Uuc3RhdHVzID09PSA1MDAgKSB7XG4gICAgICAgICAgICBhbGVydChcIkludGVybmFsIHNlcnZlciBlcnJvciwgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIik7XG4gICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbiggKCBkYXRhICkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gYHNlcnZlciBlcnJvciwgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlciFgO1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5mYWlsdWVyTWVzc2FnZShkYXRhLmRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfSlcbn07XG5cblxuXG5cbmZ1bmN0aW9uIEdzaWduSW5DYWxsYmFjayhhdXRoUmVzdWx0KSB7XG4gICAgY29uc3QgZGF0YSA9IHtjb2RlOiBhdXRoUmVzdWx0Wydjb2RlJ119O1xuICAgIGZldGNoKFwiaHR0cDovLzE4LjIyMS4xMjcuMjM3L2xvZ2luXCIsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBpY2F0aW9uL2pzb24nXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICBjYWNoZTogJ25vLWNhY2hlJyxcbiAgICB9KVxuICAgIC50aGVuKCAoIHJlc3BvbnNlICkgPT4ge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgIH0pLnRoZW4oICggZGF0YSApID0+IHtcbiAgICAgICAgZG9fc2lnbmluKHsnZW1haWwnOiBkYXRhLmVtYWlsLCAncGFzc3dvcmQnOiAnZGVmYXVsdF9wYXNzd29yZCd9KTtcbiAgICAgICAgJCgnLm1vZGFsJykubW9kYWwoJ2hpZGUnKTtcbiAgICAgICAgXG4gICAgfSlcblxufVxuXG5mdW5jdGlvbiBkb19hZGRQb3N0KHBvc3QpIHtcbiAgICByZXR1cm4gZmV0Y2goYGh0dHA6Ly8xOC4yMjEuMTI3LjIzNy9wb3N0L2FkZGAsIHtcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocG9zdCksXG4gICAgICAgIGNhY2hlOiAnbm8tY2FjaGUnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgJ2F1dGhvcml6YXRpb24nOiBgSldUICR7bG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpfWBcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOiAnUE9TVCdcbiAgICB9KVxuICAgIC50aGVuKCAoIHJlc3BvbnNlICkgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgKSB7XG4gICAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbiggKCBkYXRhICkgPT4ge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5mYWlsdWVyTWVzc2FnZShkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oICggZGF0YSApID0+IHtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5zdWNjZXNzTWVzc2FnZShkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgZG9fZ2V0UG9zdHMoKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZG9fZ2V0UG9zdHMoKSB7XG4gICAgZmV0Y2goJ2h0dHA6Ly8xOC4yMjEuMTI3LjIzNy9wb3N0cycsIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgSldUICR7bG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpfWBcbiAgICAgICAgfVxuICAgIH0pXG4gICAgICAgIC50aGVuKCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwICkge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiQW4gZXJyb3IgaGFzIG9jdXJyZWQsIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIpO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKCAoIGRhdGEgKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5mYWlsdWVyTWVzc2FnZShkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAvL2FwcGVuZCB0aGUgbW92aWVzIHRvIHRoZSB2aWV3TW9kZWxcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwucG9zdHMoZGF0YS5wb3N0cyk7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnBvc3RzLnJldmVyc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goIGZ1bmN0aW9uKCBlcnIgKSB7XG4gICAgICAgICAgICBhbGVydChcIkFuIGVycm9yIGhhcyBvY3VycmVkLCBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvciA6LVMnLCBlcnIpO1xuICAgICAgICB9KTtcbn1cblxuZnVuY3Rpb24gZG9fZGVsZXRlUG9zdChwb3N0X2lkKSB7XG4gICAgZmV0Y2goYGh0dHA6Ly8xOC4yMjEuMTI3LjIzNy9wb3N0LyR7cG9zdF9pZH1gLCB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEpXVCAke2xvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKX1gXG4gICAgICAgIH0sXG4gICAgICAgIG1ldGhvZDogJ0RFTEVURSdcbiAgICB9KVxuICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgdmlld01vZGVsLmZhaWx1ZXJNZXNzYWdlKCdOb3QgQXV0aG9yaXplZCB0byByZW1vdmUgdGhpcyBwb3N0LicpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKSB7XG4gICAgICAgICAgICB2aWV3TW9kZWwuZmFpbHVlck1lc3NhZ2UoJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIGxhdGVyJyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnJlbW92ZVBvc3RMb2NhbGx5KHBvc3RfaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhbGVydChcIkFuIGVycm9yIGhhcyBvY3VycmVkLCBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBkb19lZGl0UG9zdChwb3N0KSB7XG4gICAgZmV0Y2goYGh0dHA6Ly8xOC4yMjEuMTI3LjIzNy9wb3N0LyR7cG9zdC5pZH1gLCB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBKV1QgJHtsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyl9YFxuICAgICAgICB9LFxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7Y2F0ZWdvcnlfaWQ6IHBvc3QuY2F0ZWdvcnlfaWQsIHRpdGxlOiBwb3N0LnRpdGxlLCBib2R5OiBwb3N0LmJvZHl9KVxuICAgIH0pXG4gICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gNDAxKSB7XG4gICAgICAgICAgICBhbGVydChcIk5vdCBBdXRob3JpemVkIHRvIG1vZGlmeSB0aGlzIGNvbnRlbnQuXCIpO1xuICAgICAgICAgICAgdmlld01vZGVsLmZhaWx1ZXJNZXNzYWdlKCdOb3QgQXV0aG9yaXplZCB0byBlZGl0IHRoaXMgcG9zdC4nKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKSB7XG4gICAgICAgICAgICBhbGVydChcIkludGVybmFsIHNlcnZlciBlcnJvciwgUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIik7XG4gICAgICAgICAgICB2aWV3TW9kZWwuZmFpbHVlck1lc3NhZ2UoJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluIGxhdGVyJyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9fZ2V0UG9zdHMoKTtcbiAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhbGVydChcIkFuIGVycm9yIGhhcyBvY3VycmVkLCBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLy8gQVBQTFlFUyBUSEUgS05PQ0tPVVQgQklORElOR1NcbmtvLmFwcGx5QmluZGluZ3Modmlld01vZGVsKTsiXX0=
